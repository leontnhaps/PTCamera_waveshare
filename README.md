# ğŸ¯ PTCamera_waveshare: Optical WPT ìë™ íƒ€ê²ŸíŒ… ì‹œìŠ¤í…œ

**Waveshare Pan-Tilt ì¹´ë©”ë¼ ëª¨ë“ˆì„ í™œìš©í•œ ê³ ì •ë°€ ê´‘í•™ ë¬´ì„  ì „ë ¥ ì „ì†¡(Optical WPT) íƒ€ê²ŸíŒ… ì†”ë£¨ì…˜**

ì´ í”„ë¡œì íŠ¸ëŠ” ì»´í“¨í„° ë¹„ì „ê³¼ ë”¥ëŸ¬ë‹ì„ ê²°í•©í•˜ì—¬ ì›ê±°ë¦¬ì˜ ìˆ˜ì‹ ë¶€(Receiver)ë¥¼ ìë™ìœ¼ë¡œ íƒì§€í•˜ê³ , 2ì¶• Pan-Tilt ë©”ì»¤ë‹ˆì¦˜ì„ ì œì–´í•˜ì—¬ ë ˆì´ì €ë¥¼ ì •ë°€í•˜ê²Œ ì¡°ì¤€í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

---

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

Optical WPT ì‹œìŠ¤í…œì—ì„œ ì†¡ì‹ ë¶€(Transmitter)ê°€ ìˆ˜ì‹ ë¶€(Receiver)ë¥¼ ì •í™•í•˜ê²Œ ì§€í–¥í•˜ëŠ” ê²ƒì€ ì „ì†¡ íš¨ìœ¨ì— ê²°ì •ì ì…ë‹ˆë‹¤. ë³¸ ì‹œìŠ¤í…œì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ìˆ ì„ í†µí•©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

*   **ì‹¤ì‹œê°„ ê°ì²´ íƒì§€**: YOLOv11 ê¸°ë°˜ì˜ ë”¥ëŸ¬ë‹ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ê²Ÿì„ ì‹ë³„í•©ë‹ˆë‹¤.
*   **ì°¨ë¶„ ì˜ìƒ(Difference Imaging)**: LED ON/OFF ì´ë¯¸ì§€ë¥¼ ì°¨ë¶„í•˜ì—¬ ì£¼ë³€ê´‘ ë…¸ì´ì¦ˆë¥¼ ì œê±°í•˜ê³  ë°˜ì‚¬íŒ(Retro-reflector) ì‹ í˜¸ë¥¼ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.
*   **ì •ë°€ ì œì–´(Pointing)**: ë ˆì´ì € í”¼ë“œë°± ë£¨í”„ë¥¼ í†µí•´ í”½ì…€ ë‹¨ìœ„ì˜ ì •ë°€í•œ ì¡°ì¤€ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
*   **ì™œê³¡ ë³´ì •(Undistortion)**: ê´‘ê° ë Œì¦ˆì˜ ì™œê³¡ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì •í•˜ì—¬ ì¢Œí‘œ ê³„ì‚°ì˜ ì •í™•ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.

---

## âš™ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

ì‹œìŠ¤í…œì€ **PC(ì œì–´/ì—°ì‚°)**, **Server(ì¤‘ê³„)**, **Raspberry Pi(ì—ì´ì „íŠ¸)**ì˜ 3ê³„ì¸µ êµ¬ì¡°ë¡œ êµ¬ì„±ë˜ì–´ ìœ ì—°í•œ í™•ì¥ì„±ì„ ê°€ì§‘ë‹ˆë‹¤.

```mermaid
graph LR
    User[ğŸ‘¤ User GUI] -->|Control| PC[ğŸ–¥ï¸ PC Client]
    PC -->|Socket| Server[ğŸ“¡ Relay Server]
    Server -->|Socket| Pi[ğŸ“ Raspberry Pi Agent]
    Pi -->|UART| ESP32[ğŸ¤– Motor Driver]
    Pi -->|CSI| Cam[ğŸ“· Camera]
    PC -->|CUDA/Torch| GPU[ğŸš€ AI/Image Proc]
```

---

## ğŸ§  í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸ ë¶„ì„ (Core Algorithms)

ì´ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ê¸°ìˆ ì€ **ìŠ¤ìº”(Scanning)**ê³¼ **ì •ë°€ ì¡°ì¤€(Pointing)** ë‘ ë‹¨ê³„ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

### 1. ğŸ“· Scanning Algorithm (ê´‘ì—­ íƒìƒ‰)

ì „ì²´ ì‘ì—… ê³µê°„ì„ ê²©ì(Grid) í˜•íƒœë¡œ ìŠ¤ìº”í•˜ì—¬ íƒ€ê²Ÿ í›„ë³´êµ°ì„ íƒìƒ‰í•˜ê³  ìœ„ì¹˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

1.  **Grid Traversal**: ì„¤ì •ëœ Pan/Tilt ë²”ìœ„(ì˜ˆ: -40Â°~40Â°)ë¥¼ ì¼ì • ê°„ê²©ìœ¼ë¡œ ìˆœíšŒí•©ë‹ˆë‹¤.
2.  **Difference Imaging (ì°¨ë¶„ ì˜ìƒ)**:
    *   ê° ìœ„ì¹˜ì—ì„œ **LED ON** ì´ë¯¸ì§€ì™€ **LED OFF** ì´ë¯¸ì§€ë¥¼ ì—°ì† ì´¬ì˜í•©ë‹ˆë‹¤.
    *   `Diff = |Image_ON - Image_OFF|` ì—°ì‚°ì„ í†µí•´ ì£¼ë³€ê´‘ì„ ì œê±°í•˜ê³  ë°˜ì‚¬íŒ(Retro-reflector)ì˜ íŠ¹ì§•ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.
3.  **Undistortion (ì™œê³¡ ë³´ì •)**:
    *   ì‚¬ì „ì— ê³„ì‚°ëœ `calib.npz` (Camera Matrix **K**, Distortion Coeffs **D**)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´‘ê° ë Œì¦ˆì˜ ì™œê³¡ì„ ë³´ì •í•©ë‹ˆë‹¤.
    *   ì‹¤ì‹œê°„ ì²˜ë¦¬ë¥¼ ìœ„í•´ CUDA/Torch ê°€ì†ì„ ì§€ì›í•©ë‹ˆë‹¤.
4.  **Hybrid YOLO Detection**:
    *   **Tiling**: ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ 2x3 ê·¸ë¦¬ë“œë¡œ ë¶„í• í•˜ì—¬ ì‘ì€ ê°ì²´ íƒì§€ìœ¨ì„ ë†’ì…ë‹ˆë‹¤.
    *   **Full Inference**: ì „ì²´ ì´ë¯¸ì§€ì— ëŒ€í•´ì„œë„ ì¶”ë¡ í•˜ì—¬ í° ê°ì²´ë‚˜ ì˜ë¦° ê°ì²´ë¥¼ ë³´ì™„í•©ë‹ˆë‹¤.
    *   **NMS (Non-Max Suppression)**: ë¶„í•  ë° ì „ì²´ ì¶”ë¡  ê²°ê³¼ë¥¼ ë³‘í•©í•˜ì—¬ ì¤‘ë³µëœ ë°•ìŠ¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
5.  **Data Logging**: íƒì§€ëœ ê°ì²´ì˜ Pan/Tilt ê°ë„ì™€ BBox ì •ë³´ë¥¼ CSVë¡œ ì €ì¥í•©ë‹ˆë‹¤.

### 2. ğŸ¯ Pointing Algorithm (ì •ë°€ ì¡°ì¤€)

ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ íƒ€ê²Ÿì˜ ì¤‘ì‹¬ì„ ì¶”ì •í•˜ê³ , ë ˆì´ì € í”¼ë“œë°± ì œì–´ë¥¼ í†µí•´ ì˜¤ì°¨ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

#### Phase 1: Coarse Alignment (ì„ í˜• íšŒê·€ ì¶”ì •)
ìŠ¤ìº” ë°ì´í„°(CSV)ë¥¼ ë¶„ì„í•˜ì—¬ íƒ€ê²Ÿì´ ì´ë¯¸ì§€ ì¤‘ì‹¬(Optical Axis)ì— ì˜¤ê²Œ ë  Pan/Tilt ê°ë„ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
*   **Linear Regression**:
    *   `Pixel_X â‰ˆ a * Pan + b`
    *   `Pixel_Y â‰ˆ c * Tilt + d`
*   ìœ„ íšŒê·€ì‹ì„ ì—­ì‚°í•˜ì—¬ `Pixel_X = Width/2`, `Pixel_Y = Height/2`ê°€ ë˜ëŠ” `(Pan_Target, Tilt_Target)`ì„ ê³„ì‚°í•˜ê³  ê³ ì† ì´ë™í•©ë‹ˆë‹¤.

#### Phase 2: Laser Servoing (Closed-loop Control)
ì´ë™ í›„, ì‹¤ì œ ë ˆì´ì € ìœ„ì¹˜ì™€ íƒ€ê²Ÿ ìœ„ì¹˜ì˜ ì˜¤ì°¨ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì •í•©ë‹ˆë‹¤.
1.  **Laser Detection**:
    *   ë ˆì´ì €ë¥¼ ê¹œë¹¡ì´ë©°(ON/OFF) ì°¨ë¶„ ì˜ìƒì„ íšë“í•©ë‹ˆë‹¤.
    *   **Thresholding**: ì°¨ë¶„ ì˜ìƒì— ì„ê³„ê°’(Threshold=70)ì„ ì ìš©í•˜ì—¬ ë…¸ì´ì¦ˆë¥¼ ì œê±°í•œ í›„, ê°€ì¤‘ ë¬´ê²Œì¤‘ì‹¬(Weighted Centroid)ì„ ê³„ì‚°í•˜ì—¬ ì„œë¸Œí”½ì…€ ë‹¨ìœ„ì˜ ì •í™•ë„ë¥¼ í™•ë³´í•©ë‹ˆë‹¤.
2.  **Target Detection**:
    *   ë™ì¼í•œ ì‹œì ì˜ ì˜ìƒì—ì„œ YOLOë¥¼ í†µí•´ íƒ€ê²Ÿì˜ ì¤‘ì‹¬ ì¢Œí‘œ $(T_x, T_y)$ë¥¼ íšë“í•©ë‹ˆë‹¤.
3.  **Adaptive Feedback Control**:
    *   **Data-Driven Gain**: ìŠ¤ìº” ë‹¨ê³„ì—ì„œ ìˆ˜ì§‘ëœ ë°ì´í„°(`px/degree` ê¸°ìš¸ê¸°)ë¥¼ ì—­ì‚°(Inverse Calculation)í•˜ì—¬, ëª¨í„° ì œì–´ì— í•„ìš”í•œ ìµœì ì˜ `deg/px` ê²Œì¸ê°’ì„ ë™ì ìœ¼ë¡œ ì‚°ì¶œí•©ë‹ˆë‹¤.
    *   **Fine Adjustment**: ì˜¤ì°¨ê°€ 10px ì´í•˜ë¡œ ì¤„ì–´ë“¤ë©´ ì´ë™ëŸ‰ì„ ìµœëŒ€ 1.0ë„ë¡œ ì œí•œí•˜ëŠ” ë¯¸ì„¸ ì¡°ì • ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ì˜¤ë²„ìŠˆíŠ¸ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
    *   **Fallback Strategy**: ë ˆì´ì €ê°€ ê°ì§€ë˜ì§€ ì•Šì„ ê²½ìš°, ìë™ìœ¼ë¡œ Tiltë¥¼ 1Â°ì”© ë‚´ë¦¬ë©°(Scanning Down) ë ˆì´ì €ë¥¼ ì¬íƒìƒ‰í•˜ëŠ” ë³µêµ¬ ë¡œì§ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    *   ë¹„ë¡€ ì œì–´(P-Control)ë¥¼ í†µí•´ ì‚°ì¶œëœ ë³´ì •ëŸ‰ìœ¼ë¡œ ì˜¤ì°¨ë¥¼ 0ì— ìˆ˜ë ´ì‹œí‚µë‹ˆë‹¤.

### 1. ğŸ–¥ï¸ PC Client (`Com/`)
ì‚¬ìš©ìê°€ ì¡°ì‘í•˜ëŠ” GUI í”„ë¡œê·¸ë¨ì´ë©°, ì‹œìŠ¤í…œì˜ ë‘ë‡Œ ì—­í• ì„ í•©ë‹ˆë‹¤.

*   **`Com_main.py` (Main Entry)**
    *   í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ì ì…ë‹ˆë‹¤. `App` í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ê³  ë©”ì¸ ë£¨í”„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
    *   ì „ì²´ì ì¸ ì´ˆê¸°í™” ê³¼ì •ê³¼ ëª¨ë“ˆ ê°„ì˜ ì—°ê²°ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
    *   **`test.py`**: `Com_main.py`ì™€ ë™ì¼í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© ì‹¤í–‰ íŒŒì¼ì…ë‹ˆë‹¤. í˜„ì¬ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì§„ì…ì ì…ë‹ˆë‹¤.

*   **`app_ui.py` (GUI Layout)**
    *   `tkinter`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœˆë„ìš°, íƒ­, ë²„íŠ¼, ë¼ë²¨ ë“± ëª¨ë“  UI ìš”ì†Œë¥¼ ë°°ì¹˜í•˜ê³  êµ¬ì„±í•©ë‹ˆë‹¤.
    *   ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ì˜ ë””ìì¸ê³¼ ë ˆì´ì•„ì›ƒ ë¡œì§ì´ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

*   **`event_handlers.py` (Event Processing & Anti-Freeze)**
    *   ì„œë²„ë‚˜ ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¡œë¶€í„° ìˆ˜ì‹ ëœ ë¹„ë™ê¸° ì´ë²¤íŠ¸(ì´ë¯¸ì§€ ìˆ˜ì‹ , ìŠ¤ìº” ì§„í–‰ë¥ )ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    *   **Anti-Freeze Logic**: ë„¤íŠ¸ì›Œí¬ ë°ì´í„° í­ì£¼ ì‹œ UIê°€ ë©ˆì¶”ì§€ ì•Šë„ë¡ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë£¨í”„ì— ì œí•œ(Throttling)ì„ ë‘ì–´ ì•ˆì •ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.

*   **`pointing_handler.py` (Pointing Logic)**
    *   **í•µì‹¬ ì•Œê³ ë¦¬ì¦˜**: ì •ë°€ ì¡°ì¤€(Pointing) ëª¨ë“œì˜ ì œì–´ ë¡œì§ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    *   ë ˆì´ì € ON/OFF ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ë ˆì´ì € ì ì˜ ìœ„ì¹˜ë¥¼ ì°¾ê³ , íƒ€ê²Ÿê³¼ì˜ ì˜¤ì°¨ë¥¼ ê³„ì‚°í•˜ì—¬ ëª¨í„°ë¥¼ ì œì–´í•˜ëŠ” í”¼ë“œë°± ë£¨í”„(Closed-loop)ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

*   **`scan_utils.py` (Scan Controller)**
    *   ê´‘ì—­ ìŠ¤ìº”(Scanning) ì‘ì—…ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
    *   ì„¤ì •ëœ ë²”ìœ„ì— ë”°ë¼ Pan/Tilt ê²©ì ì¢Œí‘œë¥¼ ìƒì„±í•˜ê³ , ìˆ˜ì‹ ëœ ì´ë¯¸ì§€ì— ëŒ€í•´ YOLO ì¶”ë¡ ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    *   íƒì§€ëœ ê°ì²´ ì •ë³´ë¥¼ CSV íŒŒì¼ë¡œ ë¡œê¹…í•˜ëŠ” ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

*   **`image_utils.py` (Image Processing)**
    *   ì´ë¯¸ì§€ ë¡œë“œ, ì €ì¥ ë° ë³€í™˜ì„ ë‹´ë‹¹í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
    *   **í•µì‹¬ ê¸°ëŠ¥**: `calib.npz` ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì—¬ ê´‘ê° ë Œì¦ˆì˜ ì™œê³¡ì„ ë³´ì •(Undistortion)í•©ë‹ˆë‹¤. PyTorch/CUDA ê°€ì†ì„ ì§€ì›í•˜ì—¬ ì‹¤ì‹œê°„ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

*   **`yolo_utils.py` (AI Wrapper)**
    *   `ultralytics` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë˜í•‘í•˜ì—¬ YOLO ëª¨ë¸ì„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
    *   í° ì´ë¯¸ì§€ì—ì„œ ì‘ì€ íƒ€ê²Ÿì„ ë†“ì¹˜ì§€ ì•Šê¸° ìœ„í•´ ì´ë¯¸ì§€ë¥¼ ë¶„í• í•˜ì—¬ ì¶”ë¡ í•˜ëŠ” **Tiling** ê¸°ë²•ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

*   **`network.py` (Network Client)**
    *   ì„œë²„ì™€ í†µì‹ í•˜ê¸° ìœ„í•œ ì†Œì¼“ í´ë¼ì´ì–¸íŠ¸ í´ë˜ìŠ¤(`GuiCtrlClient`, `GuiImgClient`)ê°€ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    *   **Auto Reconnect**: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠê²¨ë„ ìë™ìœ¼ë¡œ ì¬ì—°ê²°ì„ ì‹œë„í•˜ì—¬ ì‹œìŠ¤í…œ ê°€ë™ ì‹œê°„ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.

*   **`app_helpers.py` (Helper Methods)**
    *   ìŠ¤ëƒ…ìƒ· ì´¬ì˜(`snap`), ì„¤ì •ê°’ ê³„ì‚° ë“± `App` í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë³´ì¡°ì ì¸ ë©”ì„œë“œë“¤ì„ ëª¨ì•„ë‘” íŒŒì¼ì…ë‹ˆë‹¤.

*   **`pv_vi.py` (PV Monitoring) ğŸ†•**
    *   **ì‹¤ì‹œê°„ ì „ì••/ì „ë¥˜ ëª¨ë‹ˆí„°ë§**: ì•„ë‘ì´ë…¸ì—ì„œ Serial í†µì‹ ìœ¼ë¡œ ì „ì••(V), ì „ë¥˜(mA), ì „ë ¥(mW) ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    *   **CSV Data Logging**: íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ CSV íŒŒì¼ë¡œ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ ì €ì¥í•˜ì—¬ ì¶”í›„ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. (`captures_gui_...` í´ë” ë‚´ ì €ì¥)
    *   `PVMonitor` í´ë˜ìŠ¤ëŠ” ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ë©°, thread-safe dequeë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœëŒ€ 100ê°œì˜ ë°ì´í„° í¬ì¸íŠ¸ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

### 2. ğŸ“ Raspberry Pi Agent (`Raspberrypi/`)
í•˜ë“œì›¨ì–´ë¥¼ ì§ì ‘ ì œì–´í•˜ëŠ” ì—ì´ì „íŠ¸ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.

*   **`Rasp_main.py` (Hardware Controller)**
    *   **ì¹´ë©”ë¼ ì œì–´**: `Picamera2`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ ì†ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ìº¡ì²˜í•˜ê³  ìŠ¤íŠ¸ë¦¬ë°í•©ë‹ˆë‹¤.
    *   **ëª¨í„° ì œì–´**: ì‹œë¦¬ì–¼ í¬íŠ¸(UART)ë¥¼ í†µí•´ ESP32 ê¸°ë°˜ì˜ Pan-Tilt ëª¨í„° ë“œë¼ì´ë²„ì— ëª…ë ¹ì„ ì „ì†¡í•©ë‹ˆë‹¤.
    *   PCë¡œë¶€í„° ë°›ì€ JSON ëª…ë ¹(`scan`, `move`, `snap` ë“±)ì„ í•´ì„í•˜ê³  í•˜ë“œì›¨ì–´ë¥¼ ë™ì‘ì‹œí‚µë‹ˆë‹¤.

### 3. ğŸ“¡ Relay Server (`Server/`)
PCì™€ ë¼ì¦ˆë² ë¦¬íŒŒì´ ê°„ì˜ í†µì‹ ì„ ì¤‘ê³„í•©ë‹ˆë‹¤.

*   **`Server_main.py` (Socket Broker)**
    *   TCP/IP ì†Œì¼“ ì„œë²„ë¥¼ ì—´ì–´ PCì™€ ë¼ì¦ˆë² ë¦¬íŒŒì´ì˜ ì—°ê²°ì„ ìˆ˜ë½í•©ë‹ˆë‹¤.
    *   **Non-blocking**: í´ë¼ì´ì–¸íŠ¸ì˜ ë¹„ì •ìƒ ì¢…ë£Œ ì‹œì—ë„ ì„œë²„ê°€ ë©ˆì¶”ì§€ ì•Šë„ë¡ íƒ€ì„ì•„ì›ƒ ë° ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì´ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## â˜€ï¸ PV Monitoring (ì‹¤ì‹œê°„ ì „ì••/ì „ë¥˜ ëª¨ë‹ˆí„°ë§) ğŸ†•

Pointing ëª¨ë“œ ì‹¤í–‰ ì‹œ ìˆ˜ì‹ ë¶€ì˜ ì „ì••/ì „ë¥˜ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ê´‘ ì „ë ¥ ì „ì†¡ íš¨ìœ¨ì„ ì¶”ì í•˜ëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
*   **ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘**: ì•„ë‘ì´ë…¸ì—ì„œ ì „ì••(V), ì „ë¥˜(mA), ì „ë ¥(mW) ë°ì´í„°ë¥¼ Serial í†µì‹ ìœ¼ë¡œ ìˆ˜ì§‘
*   **CSV ìë™ ë¡œê¹…**: ëª¨ë‹ˆí„°ë§ ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ CSV íŒŒì¼ì„ ìƒì„±í•˜ê³ , ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸°ë¡ (ì €ì¥ ê²½ë¡œ: `captures_gui_.../pv_data_YYYYMMDD_HHMMSS.csv`)
*   **Graph Auto-Clear**: Pointing ëª¨ë“œ ì§„ì… ì‹œ ê·¸ë˜í”„ë¥¼ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì—¬ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê¹¨ë—í•˜ê²Œ í‘œì‹œ (CSV íŒŒì¼ì€ ëª¨ë‹ˆí„°ë§ ì¬ì‹œì‘ ì‹œ ë¶„ë¦¬ë¨)
*   **Anti-Freeze Graphing**: ë¹ ë¥¸ ë°ì´í„° ìˆ˜ì‹  ì¤‘ì—ë„ UIê°€ ë©ˆì¶”ì§€ ì•Šë„ë¡ ê·¸ë˜í”„ ê°±ì‹  ì£¼ê¸°ë¥¼ ìµœì í™” (0.5ì´ˆ)
*   **Thread-safe êµ¬ì¡°**: ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ë°ì´í„° ìˆ˜ì§‘ ë° íŒŒì¼ ì“°ê¸°, ë©”ì¸ ë£¨í”„ì™€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘

### ì•„í‚¤í…ì²˜
```mermaid
graph LR
    A[Arduino] -->|Serial| B[PVMonitor Thread]
    B -->|deque| C[Data Storage]
    B -->|csv| H[CSV File]
    C -->|60ms Poll| D[update_pv_graph]
    D -->|matplotlib| E[GUI Canvas]
    F[Pointing Mode] -->|Toggle| G[Graph Clear Only]
    G -->|Control| B
```

### ì‚¬ìš© ë°©ë²•
1. **ì•„ë‘ì´ë…¸ ì—°ê²°**: ì „ì••/ì „ë¥˜ ì„¼ì„œê°€ ì—°ê²°ëœ ì•„ë‘ì´ë…¸ë¥¼ COM í¬íŠ¸ì— ì—°ê²°
2. **matplotlib ì„¤ì¹˜** (ì„ íƒ):
   ```bash
   pip install matplotlib
   ```
   *ì°¸ê³ : matplotlibì´ ì—†ì–´ë„ ë‹¤ë¥¸ ê¸°ëŠ¥ì€ ì •ìƒ ì‘ë™í•˜ë©°, PV Monitor íƒ­ì— ì„¤ì¹˜ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ*

3. **GUI ì‹¤í–‰**:
   ```bash
   cd Com
   python test.py  # ë˜ëŠ” Com_main.py (ì›ë³¸)
   ```

4. **PV Monitor íƒ­**:
   - Pointing ëª¨ë“œ í™œì„±í™” ì‹œ ìë™ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ ì‹œì‘
   - ìˆ˜ë™ ì‹œì‘: Port ì„¤ì • í›„ "â–¶ Start" ë²„íŠ¼
   - "Clear Graph" ë²„íŠ¼ìœ¼ë¡œ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”

### ì•„ë‘ì´ë…¸ ì½”ë“œ ì˜ˆì‹œ
```cpp
// ì•„ë‘ì´ë…¸ê°€ Serialë¡œ ì „ì†¡í•˜ëŠ” ë°ì´í„° í¬ë§·: "voltage,current,power\n"
float voltage = analogRead(A0) * (5.0 / 1023.0);
float current = analogRead(A1) * (100.0 / 1023.0);
float power = voltage * current;
Serial.print(voltage);
Serial.print(",");
Serial.print(current);
Serial.print(",");
Serial.println(power);
delay(100);
```

---

## ğŸ“ ë¼ì´ì„ ìŠ¤ ë° ì°¸ê³ ì‚¬í•­
*   ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ë° ì—°êµ¬ ëª©ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.
*   `calib.npz` íŒŒì¼ì´ ì—†ìœ¼ë©´ ì™œê³¡ ë³´ì • ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
*   `yolov11m_diff.pt` ëª¨ë¸ íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.
*   **matplotlib ë¼ì´ë¸ŒëŸ¬ë¦¬**: PV ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ ì‚¬ìš© ì‹œ í•„ìš” (ì„ íƒ ì‚¬í•­)
